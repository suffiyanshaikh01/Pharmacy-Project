package com.medicineStock.demo.controller;

import java.util.ArrayList;
import java.util.List;

import org.apache.http.protocol.HTTP;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.medicineStock.demo.exception.TreatingAilmentNotFoundException;
import com.medicineStock.demo.model.MedicineStock;
import com.medicineStock.demo.service.MedicineStockService;

import lombok.extern.slf4j.Slf4j;

@RestController
@Slf4j
@RequestMapping("/MedicineStockInformation")
public class MedicineStockController {
	@Autowired
	MedicineStockService medicineService;
	
	@GetMapping("")
	public ResponseEntity<?> getAllMedicineStock(){
	log.info("Start getAllMedicineStock");
	return new ResponseEntity<>(medicineService.getAllMecidineStock(),HttpStatus.OK);
	
 }
//	@PostMapping("/addMedicine")
//	public ResponseEntity<?> addMedicine(@RequestBody MedicineStock medicine) {
//		log.info("Start addMedicine");
//		return new ResponseEntity<>(medicineService.addMedicine(medicine),HttpStatus.OK);
//	}
	
	@PutMapping("/updateStock/{id}/{count}")
	public ResponseEntity<Boolean> updateStock(@PathVariable int id, @PathVariable int count) {
		log.info("Start updateStock");
		return new ResponseEntity<>(medicineService.updateStock(id,count),HttpStatus.OK);
	}
	
	@GetMapping("/byTreatingAilment/{treatingAilment}")
	public ResponseEntity<?> getMedicineByAilment(@PathVariable("treatingAilment") String ailment){
		log.info("Start getMedicineByAilment");
		log.debug("Treating ailment :",ailment);
		List<MedicineStock> mlist = medicineService.getMedicineByAilment(ailment);
		try {
		if(mlist.isEmpty()) {
			throw new TreatingAilmentNotFoundException("Treating Ailment not found !!!!!!!!!!!!");
		}
		} catch(TreatingAilmentNotFoundException treatingAilmentNotFound) {
			log.error(treatingAilmentNotFound.toString());
		}
		
		log.debug("Medicine List :",mlist);
		List<String> medicineNames = new ArrayList<>();
		for(MedicineStock m : mlist) {
			medicineNames.add(m.getMedicineName());
		}
		log.debug("Medicine Names", medicineNames);
		 String[] medicinesNamesArray = medicineNames.toArray(new String[0]);
		 return new ResponseEntity<>(medicinesNamesArray,HttpStatus.OK);
	}
	
	@GetMapping("/get-stock-count/{medicine}")
	public ResponseEntity<?> getMedicineStockByMedicineName(@PathVariable String medicine) {
		log.info("Start getMedicineByAilment");
//		return medicineService.getMedicineStockByMedicineName(medicine);
		return new ResponseEntity<>(medicineService.getMedicineStockByMedicineName(medicine), HttpStatus.OK);
	}
	
}












